{% extends "base.html" %}

{% block title %}Data Ingestion Client Panel{% endblock %}

{% block content %}
    <!-- Review Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Review Data Ingestion Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Please review your submission before proceeding:</p>
                    <div class="table-responsive">
                        <table class="table table-bordered confirmation-table">
                            <thead>
                                <tr>
                                    <th>From Field</th>
                                    <th class="from-value">From Value</th>
                                    <th class="reviewed-column">Reviewed</th>
                                </tr>
                            </thead>
                            <tbody id="confirmationTableBody">
                                <!-- Rows will be dynamically added here by script.js -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelReview">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmSubmit" disabled>Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal fade" id="progressModal" tabindex="-1" aria-labelledby="progressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="progressModalLabel">Upload Progress</h5>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p id="progressText" class="mt-2">Uploading... 0%</p>
                </div>
            </div>
        </div>
    </div>

    <h2 class="mt-4 mb-3 text-center">Data Ingestion Client Panel</h2>
    <div class="card shadow-lg">
        <div class="card-body">
            <form id="dataIngestionForm">
                <!-- Select a file -->
                <div class="mb-3">
                    <label for="selectFile" class="form-label">Select a file</label>
                    <input type="file" class="form-control" id="selectFile" name="file">
                    <small id="fileSizeMessage" class="form-text"></small>
                </div>

                <!-- Pre-fill -->
                <div class="mb-3 text-center">
                    <button type="button" class="btn btn-secondary" id="preFill">Pre-fill</button>
                </div>

                <!-- Operation -->
                <div class="mb-3">
                    <label for="operation" class="form-label">Operation</label>
                    <input type="text" class="form-control" id="operation" name="operation">
                </div>

                <!-- File Information Section -->
                <div class="mb-3">
                    <h5>File Information</h5>
                    <div class="row">
                        <div class="col">
                            <label for="fileSelectCheck" class="form-label">Select</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="fileSelectCheck" checked>
                                <label class="form-check-label" for="fileSelectCheck">Select</label>
                            </div>
                        </div>
                        <div class="col">
                            <label for="fileName" class="form-label">File Name</label>
                            <input type="text" class="form-control" id="fileName" name="file_name" placeholder="File name" readonly>
                            <small id="fileSize" class="form-text"></small>
                        </div>
                        <div class="col">
                            <label for="deviceType" class="form-label">Device Type</label>
                            <select class="form-select" id="deviceType" name="device_type">
                                <option value="laptop">Laptop</option>
                                <option value="phone">Phone</option>
                                <option value="other">Other</option>
                                <option value="unknown">Unknown</option>
                            </select>
                        </div>
                        <div class="col">
                            <label for="serialNumber" class="form-label">Serial No</label>
                            <input type="text" class="form-control" id="serialNumber" name="serial_number" placeholder="Serial No">
                        </div>
                        <div class="col">
                            <label for="itemNumber" class="form-label">Item No</label>
                            <input type="text" class="form-control" id="itemNumber" name="item_number" value="001">
                        </div>
                        <div class="col">
                            <label for="subNumber" class="form-label">Sub No</label>
                            <input type="text" class="form-control" id="subNumber" name="sub_number" value="1">
                        </div>
                    </div>
                </div>

                <!-- Collection -->
                <div class="mb-3">
                    <label for="collection" class="form-label">Collection</label>
                    <select class="form-select" id="collection" name="collection">
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="unknown">Unknown</option>
                    </select>
                </div>

                <!-- Platform -->
                <div class="mb-3">
                    <label for="platform" class="form-label">Platform</label>
                    <select class="form-select" id="platform" name="platform">
                        <option value="red">Windows</option>
                        <option value="blue">MacOS</option>
                        <option value="unknown">Unknown</option>
                    </select>
                </div>

                <!-- Date of Collection -->
                <div class="mb-3">
                    <label for="dateOfCollection" class="form-label">Date of Collection</label>
                    <input type="date" class="form-control" id="dateOfCollection" name="date_of_collection">
                </div>

                <!-- Known Passwords -->
                <div class="mb-3">
                    <label for="knownPasswords" class="form-label">Known passwords (separated with comma)</label>
                    <input type="text" class="form-control" id="knownPasswords" name="known_passwords">
                </div>

                <!-- Notes -->
                <div class="mb-3">
                    <label for="notes" class="form-label">Notes</label>
                    <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                </div>

                <!-- Rename File and Manual Processing Section -->
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="renameFileCheck">
                        <label class="form-check-label" for="renameFileCheck">Rename file</label>
                    </div>
                    <label for="renamePreview" class="form-label mt-2">File Name Preview</label>
                    <input type="text" class="form-control" id="renamePreview" value="" readonly>
                </div>

                <div class="mb-3">
                    <label for="processingMethod" class="form-label">Processing Method</label>
                    <select class="form-select" id="processingMethod" name="processingMethod">
                        <option value="Normal" selected>Normal</option>
                        <option value="MX Pipeline">MX Pipeline</option>
                        <option value="Manual on PN03">Manual on PN03</option>
                        <option value="Manual on PN04">Manual on PN04</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="button" class="btn btn-primary" id="openConfirmationModal">Submit</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/submit.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chunked-upload.js') }}"></script>
{% endblock %}